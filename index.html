<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- Security: Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://unpkg.com; style-src 'self' https://unpkg.com https://fonts.googleapis.com 'unsafe-inline'; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https://unpkg.com https://*.basemaps.cartocdn.com https://images.unsplash.com; connect-src 'self';">

    <title>Belize: An Elemental Journey</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="" defer></script>

    <!-- Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">

    <!-- Scripts (Deferred for Performance) -->
    <script src="js/data.js" defer></script>
    <script src="js/Utils.js" defer></script>
    <script src="constellations.js" defer></script>
    <script src="LogisticsCore.js" defer></script>
    <script src="DecisionSupport.js" defer></script>
    <script src="StrategicPathfinder.js" defer></script>
    <script src="TacticalOverlay.js" defer></script>
    <script src="expedition.js" defer></script>
    <script src="MissionSimulator.js" defer></script>
    <script src="js/modules/TelemetryStream.js" defer></script>
    <script src="js/modules/Overwatch.js" defer></script>
    <script src="app.js" defer></script>
</head>
<body>
    <!-- Background Elements -->
    <canvas id="constellation-canvas" role="img" aria-label="Constellation background animation"></canvas>
    <div id="map" role="application" aria-label="Interactive Map of Belize"></div>

    <!-- Top UI Layer -->
    <div id="top-bar">
        <div id="filter-container" class="glass-panel" role="group" aria-label="Location Filters">
            <button class="filter-btn active" data-filter="all" aria-pressed="true">All</button>
            <button class="filter-btn" data-filter="ruins" aria-pressed="false">Ruins</button>
            <button class="filter-btn" data-filter="nature" aria-pressed="false">Nature</button>
            <button class="filter-btn" data-filter="marine" aria-pressed="false">Marine</button>
        </div>
        <button id="tactical-toggle" class="glass-panel btn-reset" aria-pressed="false" aria-label="Toggle Tactical Mode">
            <div class="toggle-icon"></div>
            <span>Tactical Mode</span>
        </button>
    </div>

    <!-- Info Panel (Details) -->
    <div id="info-panel" class="glass-panel" role="region" aria-label="Location Information" tabindex="-1">
        <div class="panel-handle"></div> <!-- Visible only on mobile/css hook -->
        <div class="panel-image-container">
            <img id="panel-image" src="" alt="Location View">
            <div class="panel-image-overlay"></div>
        </div>
        <button id="close-panel" class="btn-reset" aria-label="Close Panel">
            <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
        <div id="panel-content">
            <div id="panel-type" class="tag">Marine</div>
            <h2 id="panel-title">Great Blue Hole</h2>

            <div class="meta-row">
                <div class="meta-item">
                    <span class="meta-label">Risk Level</span>
                    <span class="meta-val" style="color: var(--danger-red)">CRITICAL</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Access</span>
                    <span class="meta-val">COMPLEX</span>
                </div>
            </div>

            <p id="panel-description">Description goes here.</p>
            <div id="panel-atmosphere" style="font-style: italic; color: var(--text-tertiary); margin-bottom: 24px; border-left: 2px solid var(--glow-cyan); padding-left: 12px;"></div>

            <button id="btn-add-expedition" class="btn-reset">Initialize Target</button>
        </div>
    </div>

    <!-- Expedition HUD -->
    <div id="expedition-hud" class="glass-panel">
        <div class="hud-header">
            <span class="hud-title">Expedition Log</span>
            <span id="expedition-count" class="hud-count">0 Targets</span>
        </div>

        <div class="hud-stats">
            <span style="font-size: 0.8rem; color: var(--text-secondary);">Risk Profile</span>
            <span id="risk-display" class="risk-badge" style="color: var(--glow-cyan)">LOW</span>
        </div>

        <div id="expedition-list">
            <!-- Items injected here -->
        </div>

        <div style="margin: 20px 0 10px 0; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;">
            <span style="font-size: 0.7rem; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.05em; display:block; margin-bottom: 10px;">Required Loadout</span>
            <div id="gear-container" class="gear-grid">
                <!-- Gear items injected here -->
            </div>
        </div>

        <button id="btn-generate-brief" class="btn-action">Generate Brief</button>
        <button id="btn-simulate-mission" class="btn-action simulate-btn">Simulate</button>
        <button id="btn-clear-expedition" class="btn-action secondary">Clear</button>
    </div>

    <!-- Mission Control -->
    <div id="mission-control" class="glass-panel">
        <div class="mc-top">
            <span class="mc-title">Sentinel: Live Ops</span>
            <span id="mc-timer" class="mc-time">00:00:00</span>
        </div>
        <div class="mc-body">
            <div class="bars-container">
                <div class="bar-wrap">
                    <div class="bar-meta"><span>Integrity</span><span id="val-integrity">100%</span></div>
                    <div class="bar-track"><div id="bar-integrity" class="bar-fill"></div></div>
                </div>
                <div class="bar-wrap">
                    <div class="bar-meta"><span>Supplies</span><span id="val-supplies">100%</span></div>
                    <div class="bar-track"><div id="bar-supplies" class="bar-fill"></div></div>
                </div>
                <div class="bar-wrap">
                    <div class="bar-meta"><span>Fatigue</span><span id="val-fatigue">0%</span></div>
                    <div class="bar-track"><div id="bar-fatigue" class="bar-fill" style="background: var(--danger-red); width: 0%;"></div></div>
                </div>
            </div>
            <div id="mc-log-container" class="log-container" aria-live="polite" role="log"></div>
        </div>
        <div style="padding: 16px 24px; border-top: 1px solid var(--glass-border); display: flex; justify-content: flex-end; gap: 12px;">
            <button id="btn-mc-pause" class="btn-action" style="width: auto; padding: 8px 20px; font-size: 0.8rem;">Pause</button>
            <button id="btn-mc-abort" class="btn-action secondary" style="width: auto; padding: 8px 20px; font-size: 0.8rem;">Abort</button>
        </div>
    </div>

    <!-- Briefing Modal -->
    <div id="briefing-modal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="briefing-title">
        <div class="modal-card">
            <button id="close-briefing" class="close-modal-btn" aria-label="Close Briefing">&times;</button>
            <div class="modal-header">
                <h2 id="briefing-title">Mission Briefing</h2>
            </div>
            <div class="modal-body">
                <div class="stat-grid">
                    <div class="stat-block"><span class="label">Codename</span><span id="brief-codename" class="val">ALPHA</span></div>
                    <div class="stat-block"><span class="label">ETA</span><span id="brief-eta" class="val">--</span></div>
                    <div class="stat-block"><span class="label">Distance</span><span id="brief-distance" class="val">--</span></div>
                    <div class="stat-block"><span class="label">Terrain</span><span id="brief-terrain" class="val">--</span></div>
                </div>
                <div class="brief-text">
                    <p id="brief-text">Calculating...</p>
                    <div id="brief-warnings" style="color: var(--danger-red); font-weight: 700; margin-top: 10px; display: none;"></div>
                    <span id="brief-count" style="display:none"></span>
                    <span id="brief-risk" style="display:none"></span>
                </div>
                <div style="margin-top: 24px; display: flex; gap: 12px; justify-content: flex-end;">
                     <button id="btn-save-scenario" class="btn-action secondary" style="width: auto; margin:0;">Save to Archives</button>
                     <button id="btn-brief-execute" class="btn-action" style="width: auto; margin:0;">Execute</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tactical Archives Modal -->
    <div id="archives-modal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="archives-title">
        <div class="modal-card" style="width: 100%; max-width: 800px; height: 600px; display: flex; flex-direction: column;">
            <button id="close-archives" class="close-modal-btn" aria-label="Close Archives">&times;</button>
            <div class="modal-header">
                <h2 id="archives-title">Tactical Archives</h2>
            </div>
            <div class="modal-body" style="display: flex; gap: 24px; flex: 1; min-height: 0;">
                <div id="archives-list" class="archives-list" style="flex: 1; overflow-y: auto; padding-right: 12px; border-right: 1px solid rgba(255,255,255,0.1);">
                    <!-- Dynamic List -->
                </div>
                <div id="archives-details" class="archives-details" style="flex: 1.5; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
                    <span style="color: var(--text-tertiary);">Select a mission profile to analyze.</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Intro Splash -->
    <div id="introduction" role="button" tabindex="0" aria-label="Start Application">
        <h1 class="intro-title">Belize</h1>
        <div class="intro-sub">An Elemental Journey</div>
        <div class="intro-hint">Press Enter or Click to Begin</div>
    </div>
</body>
</html>
