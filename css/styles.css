        /*
         * DESIGN SYSTEM: "Ethereal Tech" v2.0
         * "Ultrathink" Polish: Deep, Atmospheric, Precision.
        */
        :root {
            /* Palette - Deep Space & Bioluminescence */
            --abyss-blue: #02040a;
            --abyss-surface: #0a111a;
            --ocean-teal: #007a8a;
            --sand-white: #f0f4f8;
            --glow-cyan: #64ffda;
            --glow-cyan-dim: rgba(100, 255, 218, 0.15);
            --glow-cyan-bright: rgba(100, 255, 218, 0.6);
            --danger-red: #ff5252;
            --warning-gold: #ffd700;

            /* Glass & Surfaces */
            --glass-bg: rgba(10, 15, 22, 0.75);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-border-highlight: rgba(255, 255, 255, 0.15);
            --glass-blur: 32px;
            --glass-shadow: 0 12px 40px -8px rgba(0, 0, 0, 0.6);
            --panel-radius: 20px;

            /* Typography */
            --font-ui: 'Inter', system-ui, -apple-system, sans-serif;
            --font-display: 'Space Grotesk', monospace;
            --text-primary: #e6f1f5;
            --text-secondary: #94a3b8;
            --text-tertiary: #64748b;

            /* Motion */
            --ease-fluid: cubic-bezier(0.2, 0.0, 0.2, 1.0); /* Fluid ease-out */
            --ease-snap: cubic-bezier(0.34, 1.56, 0.64, 1);   /* Bouncy */
        }

        *, *::before, *::after {
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            margin: 0; padding: 0;
            height: 100%; width: 100%;
            overflow: hidden;
            background-color: var(--abyss-blue);
            font-family: var(--font-ui);
            color: var(--text-primary);
            font-size: 16px;
        }

        /* --- UTILS --- */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-top: 1px solid var(--glass-border-highlight);
            box-shadow: var(--glass-shadow);
        }

        .btn-reset { border: none; background: none; padding: 0; cursor: pointer; }

        /* --- MAP & OVERLAYS --- */
        #map {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;
            background-color: var(--abyss-blue);
        }

        .leaflet-tile-pane {
            filter: grayscale(1) brightness(0.25) invert(0) sepia(0.2) hue-rotate(190deg) saturate(1.5) contrast(1.1);
            transition: filter 1s var(--ease-fluid);
        }

        /* Tactical Mode: High Contrast, Green tint */
        #map.tactical-mode-active .leaflet-tile-pane {
            filter: grayscale(1) brightness(0.3) sepia(1) hue-rotate(100deg) saturate(2) contrast(1.5);
        }

        /* Markers */
        .leaflet-marker-icon {
            border-radius: 50%;
            background-color: var(--abyss-blue);
            border: 2px solid var(--glow-cyan);
            box-shadow: 0 0 15px var(--glow-cyan-dim);
            transition: all 0.4s var(--ease-snap);
        }
        .leaflet-marker-icon.active {
            transform: scale(1.4) !important;
            background-color: var(--glow-cyan);
            box-shadow: 0 0 30px var(--glow-cyan-bright);
            z-index: 1000 !important;
            border-color: #fff;
        }
        .leaflet-marker-icon.dimmed {
            opacity: 0.1; filter: grayscale(1); transform: scale(0.6);
        }
        .leaflet-control-container { display: none; }

        /* --- UI LAYER --- */

        /* 1. TOP BAR: Filter Pill & Tactical Toggle */
        #top-bar {
            position: fixed; top: 24px; left: 0; width: 100%;
            display: flex; justify-content: center; align-items: flex-start;
            pointer-events: none; z-index: 1000;
            padding: 0 24px;
        }

        #filter-container {
            pointer-events: auto;
            border-radius: 99px;
            padding: 6px;
            display: flex; gap: 4px;
            opacity: 0;
            animation: fade-in-down 0.8s var(--ease-fluid) 0.5s forwards;
        }

        @keyframes fade-in-down { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        .filter-btn {
            padding: 8px 20px;
            border-radius: 99px;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background: transparent;
            border: none;
            cursor: pointer;
        }
        .filter-btn:hover { color: var(--text-primary); background: rgba(255,255,255,0.05); }
        .filter-btn.active {
            color: var(--abyss-blue);
            background: var(--glow-cyan);
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(100, 255, 218, 0.4);
        }

        #tactical-toggle {
            position: absolute; right: 24px; top: 0;
            pointer-events: auto;
            border-radius: 99px;
            padding: 8px 16px;
            display: flex; align-items: center; gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            animation: fade-in-down 0.8s var(--ease-fluid) 0.6s forwards;
        }
        #tactical-toggle:hover { background: rgba(255,255,255,0.1); }
        #tactical-toggle.active {
            background: rgba(100, 255, 218, 0.1);
            border-color: var(--glow-cyan);
            box-shadow: 0 0 20px var(--glow-cyan-dim);
        }
        #tactical-toggle span {
            font-family: var(--font-display);
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--text-primary);
        }
        .toggle-icon {
            width: 8px; height: 8px; border-radius: 50%;
            background: var(--text-tertiary);
            transition: background 0.3s;
        }
        #tactical-toggle.active .toggle-icon { background: var(--glow-cyan); box-shadow: 0 0 8px var(--glow-cyan); }


        /* 2. INFO PANEL (DETAILS) */
        #info-panel {
            position: fixed; top: 100px; left: 32px; bottom: 32px; width: 400px;
            z-index: 900;
            display: flex; flex-direction: column;
            transform: translateX(-120%);
            transition: transform 0.6s var(--ease-fluid), opacity 0.6s ease;
            opacity: 0; pointer-events: none;
            border-radius: var(--panel-radius);
            overflow: hidden;
        }
        #info-panel.visible {
            transform: translateX(0); opacity: 1; pointer-events: auto;
        }

        .panel-image-container {
            width: 100%; height: 260px; position: relative; overflow: hidden; flex-shrink: 0;
        }
        #panel-image {
            width: 100%; height: 100%; object-fit: cover;
            transition: transform 0.8s ease;
        }
        #panel-image.loading { opacity: 0; filter: blur(20px); }

        /* Gradient overlay for text readability */
        .panel-image-overlay {
            position: absolute; inset: 0;
            background: linear-gradient(to bottom, transparent 40%, var(--abyss-blue) 100%);
        }

        #panel-content {
            flex: 1; padding: 0 32px 32px; overflow-y: auto;
            mask-image: linear-gradient(to bottom, black calc(100% - 40px), transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black calc(100% - 40px), transparent 100%);
            margin-top: -60px; /* Pull up over image */
            position: relative; z-index: 2;
        }

        #panel-title {
            font-family: var(--font-display);
            font-size: 2.5rem; line-height: 1.1; font-weight: 500;
            margin: 0 0 8px 0; color: #fff;
            text-shadow: 0 4px 20px rgba(0,0,0,0.8);
        }

        .tag {
            display: inline-block;
            font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em;
            color: var(--abyss-blue); background: var(--glow-cyan);
            padding: 4px 10px; border-radius: 4px; margin-bottom: 20px;
        }

        #panel-description {
            font-size: 1rem; line-height: 1.7; color: var(--text-primary);
            margin-bottom: 24px; font-weight: 300;
        }

        .meta-row {
            display: flex; gap: 16px; margin-bottom: 24px;
            border-top: 1px solid rgba(255,255,255,0.1); padding-top: 16px;
        }
        .meta-item { display: flex; flex-direction: column; }
        .meta-label { font-size: 0.7rem; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 4px; }
        .meta-val { font-family: var(--font-display); font-size: 0.9rem; color: var(--sand-white); }

        #btn-add-expedition {
            width: 100%; padding: 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: var(--glow-cyan);
            font-family: var(--font-display);
            text-transform: uppercase; letter-spacing: 0.1em; font-weight: 600;
            cursor: pointer; transition: all 0.2s ease;
        }
        #btn-add-expedition:hover {
            background: var(--glow-cyan); color: var(--abyss-blue);
            box-shadow: 0 0 30px var(--glow-cyan-dim);
            transform: translateY(-2px);
        }
        #btn-add-expedition.secondary {
            border-color: var(--danger-red); color: var(--danger-red);
        }
        #btn-add-expedition.secondary:hover {
            background: var(--danger-red); color: white;
        }

        #close-panel {
            position: absolute; top: 24px; right: 24px;
            width: 36px; height: 36px; border-radius: 50%;
            background: rgba(0,0,0,0.4); backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 10;
            border: 1px solid rgba(255,255,255,0.1);
            transition: background 0.2s;
        }
        #close-panel:hover { background: rgba(255,255,255,0.1); }
        #close-panel svg { width: 14px; height: 14px; fill: white; }


        /* 3. EXPEDITION HUD (RIGHT) */
        #expedition-hud {
            position: fixed; top: 100px; right: 32px; width: 300px;
            z-index: 900;
            border-radius: var(--panel-radius);
            padding: 24px;
            color: var(--text-primary);
            transform: translateX(120%);
            transition: transform 0.6s var(--ease-fluid);
        }
        #expedition-hud.visible { transform: translateX(0); }

        .hud-header {
            display: flex; justify-content: space-between; align-items: baseline;
            margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 12px;
        }
        .hud-title {
            font-family: var(--font-display); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.1em;
            color: var(--glow-cyan);
        }
        .hud-count { font-size: 0.75rem; color: var(--text-tertiary); font-family: var(--font-display); }

        #expedition-list {
            max-height: 30vh; overflow-y: auto; margin-bottom: 20px;
            display: flex; flex-direction: column; gap: 8px;
        }
        .target-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 12px;
            background: rgba(255,255,255,0.03); border-radius: 8px;
            font-size: 0.85rem; color: var(--text-secondary);
            transition: background 0.2s;
        }
        .target-row:hover { background: rgba(255,255,255,0.06); color: var(--text-primary); }
        .target-remove {
            color: var(--text-tertiary); cursor: pointer; padding: 4px;
            transition: color 0.2s;
        }
        .target-remove:hover { color: var(--danger-red); }

        .hud-stats {
            background: rgba(0,0,0,0.3); border-radius: 8px; padding: 12px;
            margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .risk-badge {
            font-family: var(--font-display); font-weight: 700; font-size: 0.9rem;
        }

        /* Gear Checkboxes */
        .gear-grid {
            display: grid; grid-template-columns: 1fr; gap: 8px; margin-bottom: 24px;
        }
        .gear-item {
            display: flex; align-items: center; gap: 10px;
            font-size: 0.8rem; color: var(--text-secondary);
            cursor: pointer; user-select: none;
            padding: 4px 0;
        }
        .gear-checkbox {
            appearance: none; width: 16px; height: 16px;
            border: 1px solid var(--text-tertiary); border-radius: 4px;
            background: rgba(0,0,0,0.3);
            display: grid; place-content: center;
            transition: all 0.2s;
        }
        .gear-checkbox::before {
            content: ""; width: 8px; height: 8px; transform: scale(0);
            background-color: var(--glow-cyan); border-radius: 2px;
            transition: transform 0.2s var(--ease-snap);
        }
        .gear-checkbox:checked { border-color: var(--glow-cyan); }
        .gear-checkbox:checked::before { transform: scale(1); }

        .btn-action {
            width: 100%; padding: 12px;
            background: var(--glow-cyan); color: var(--abyss-blue);
            border: none; border-radius: 8px;
            font-family: var(--font-display); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;
            cursor: pointer; margin-bottom: 8px;
            transition: transform 0.2s;
        }
        .btn-action:hover { transform: translateY(-1px); box-shadow: 0 4px 15px var(--glow-cyan-dim); }
        .btn-action.secondary { background: rgba(255,255,255,0.05); color: var(--text-secondary); }
        .btn-action.secondary:hover { background: rgba(255,255,255,0.1); color: var(--text-primary); }


        /* 4. MISSION CONTROL (BOTTOM CENTER) */
        #mission-control {
            position: fixed; bottom: 32px; left: 50%; transform: translateX(-50%) translateY(150%);
            width: 600px; height: auto;
            z-index: 1000;
            border-radius: var(--panel-radius);
            padding: 0;
            transition: transform 0.6s var(--ease-snap);
            display: flex; flex-direction: column;
            overflow: hidden;
        }
        #mission-control.visible { transform: translateX(-50%) translateY(0); }

        .mc-top {
            background: rgba(0, 0, 0, 0.4);
            padding: 16px 24px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--glass-border);
        }
        .mc-title { font-family: var(--font-display); color: var(--glow-cyan); letter-spacing: 0.1em; }
        .mc-timer { font-family: var(--font-display); font-variant-numeric: tabular-nums; font-size: 1.2rem; }

        .mc-body { padding: 24px; display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }

        .bars-container { display: flex; flex-direction: column; gap: 16px; }
        .bar-wrap { display: flex; flex-direction: column; gap: 6px; }
        .bar-meta { display: flex; justify-content: space-between; font-size: 0.75rem; text-transform: uppercase; color: var(--text-tertiary); letter-spacing: 0.05em; }
        .bar-track { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 99px; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--glow-cyan); transition: width 0.5s ease; }

        .log-container {
            background: rgba(0,0,0,0.3); border-radius: 8px; padding: 12px;
            height: 120px; overflow-y: auto;
            font-family: monospace; font-size: 0.8rem; color: var(--text-secondary);
            border: 1px solid var(--glass-border);
        }
        .log-line { margin-bottom: 4px; }
        .log-line.critical { color: var(--danger-red); }
        .log-line.success { color: var(--glow-cyan); }


        /* 5. INTRODUCTION (SPLASH) */
        #introduction {
            position: fixed; inset: 0; z-index: 2000;
            background: radial-gradient(circle at center, #051621 0%, #000 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 1s ease;
        }
        #introduction.hidden { opacity: 0; pointer-events: none; }

        .intro-title {
            font-family: var(--font-display); font-size: clamp(3rem, 10vw, 8rem); font-weight: 200;
            letter-spacing: 0.2em; color: transparent;
            background: linear-gradient(to bottom, #fff, #5f7485);
            -webkit-background-clip: text; background-clip: text;
            margin: 0; text-transform: uppercase;
        }
        .intro-sub {
            font-family: var(--font-ui); font-size: 1rem; text-transform: uppercase; letter-spacing: 0.3em;
            color: var(--glow-cyan); margin-top: 1rem; opacity: 0.8;
        }
        .intro-hint {
            position: absolute; bottom: 40px; font-size: 0.8rem; color: var(--text-tertiary);
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

        #constellation-canvas { position: fixed; inset: 0; pointer-events: none; z-index: 0; opacity: 0.5; }


        /* 6. BRIEFING MODAL */
        .modal-backdrop {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);
            z-index: 3000; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal-backdrop.visible { opacity: 1; pointer-events: auto; }

        .modal-card {
            width: 90%; max-width: 500px;
            background: #080f16; border: 1px solid var(--glow-cyan);
            border-radius: 24px; padding: 40px;
            box-shadow: 0 0 60px rgba(100, 255, 218, 0.1);
            transform: scale(0.95); transition: transform 0.4s var(--ease-snap);
        }
        .modal-backdrop.visible .modal-card { transform: scale(1); }

        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; border-bottom: 1px solid var(--glass-border); padding-bottom: 16px; }
        .modal-header h2 { margin: 0; font-family: var(--font-display); color: var(--glow-cyan); letter-spacing: 0.1em; font-weight: 400; }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
        .stat-block .label { font-size: 0.7rem; color: var(--text-tertiary); text-transform: uppercase; display: block; margin-bottom: 4px; }
        .stat-block .val { font-family: var(--font-display); font-size: 1.1rem; color: white; }

        .brief-text { font-size: 0.95rem; line-height: 1.6; color: var(--text-secondary); background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px; }

        .close-modal-btn { position: absolute; top: 20px; right: 20px; background: none; border: none; color: var(--text-tertiary); cursor: pointer; font-size: 1.5rem; }


        /* --- MOBILE OPTIMIZATION --- */
        @media (max-width: 768px) {
            /* Adjust Top Bar */
            #top-bar { top: 12px; padding: 0 12px; justify-content: flex-start; }
            #filter-container { overflow-x: auto; max-width: 70%; -webkit-overflow-scrolling: touch; padding: 4px; }
            .filter-btn { padding: 6px 16px; font-size: 0.8rem; white-space: nowrap; flex-shrink: 0; }

            #tactical-toggle { top: 0; right: 12px; padding: 6px 12px; }
            #tactical-toggle span { display: none; } /* Icon only on mobile */
            .toggle-icon { width: 12px; height: 12px; }

            /* Bottom Sheet: Info Panel */
            #info-panel {
                top: auto; left: 0; right: 0; bottom: 0; width: 100%; height: 75vh;
                border-radius: 24px 24px 0 0;
                transform: translateY(110%);
                padding-bottom: env(safe-area-inset-bottom);
            }
            #info-panel.visible { transform: translateY(0); }

            .panel-handle {
                position: absolute; top: 8px; left: 50%; transform: translateX(-50%);
                width: 40px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 99px;
                z-index: 20;
            }
            #close-panel { top: 16px; right: 16px; width: 32px; height: 32px; }

            .panel-image-container { height: 200px; }
            #panel-content { margin-top: -30px; padding: 0 24px 24px; }
            #panel-title { font-size: 2rem; }

            /* Bottom Sheet: Expedition HUD */
            #expedition-hud {
                top: auto; left: 0; right: 0; bottom: 0; width: 100%; height: auto; max-height: 80vh;
                border-radius: 24px 24px 0 0;
                transform: translateY(110%);
                padding-bottom: max(24px, env(safe-area-inset-bottom));
            }
            #expedition-hud.visible { transform: translateY(0); }

            /* Mission Control Mobile */
            #mission-control { width: 100%; bottom: 0; border-radius: 24px 24px 0 0; padding-bottom: env(safe-area-inset-bottom); }
            .mc-body { grid-template-columns: 1fr; gap: 16px; padding: 16px; }
            .log-container { height: 80px; }
        }
